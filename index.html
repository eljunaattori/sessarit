<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Sessarit m√§ppi by Elju</title>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="pageWrapper">
  <h1 id="title">Sessarit m√§ppi</h1>

  <div id="topLeftOverlay">
    <img src="https://i.postimg.cc/kGh9crzN/glizzy.jpg" alt="Logo">
    <span>made by Eljunaattori<br>GRRRRPOW POW POW</span>
  </div>

  <button id="addSpotBtn">Lis√§√§ Spotti</button>

  <div id="spotForm" style="display: none;">
    <form id="addSpotForm">
      <h2>Lis√§√§ Spotti</h2>
      <label for="spotTitle">Nimi:</label>
      <input type="text" id="spotTitle" required>
      
      <label for="spotDesc">Kuvaus:</label>
      <textarea id="spotDesc" rows="3" required></textarea>

      <label for="spotImageUrl">Kuvan URL (valinnainen):</label>
      <input type="text" id="spotImageUrl" placeholder="https://example.com/image.jpg">

      <label>T√§git:</label>
      <div id="tagOptions">
        <button type="button" class="tagBtn">Boxi</button>
        <button type="button" class="tagBtn">Ditsi</button>
        <button type="button" class="tagBtn">Stairs</button>
        <button type="button" class="tagBtn">Droppi</button>
        <button type="button" class="tagBtn">G√§ppi</button>
        <button type="button" class="tagBtn">Railii</button>
        <button type="button" class="tagBtn">Kurbi</button>
        <button type="button" class="tagBtn">Hillbomb</button>
        <button type="button" class="tagBtn">Parkki</button>
        <button type="button" class="tagBtn">P-Halli</button>
        <button type="button" class="tagBtn">DIY</button>
        <button type="button" class="tagBtn">Smuuttii Fl√§ttii</button>
        <button type="button" class="tagBtn">Raffii Fl√§ttii</button>
      </div>
      
      <button type="submit">Lis√§√§</button>
      <button type="button" id="cancelSpot">Peruuta</button>
    </form>
  </div>

  <div id="filterContainer">
    <button id="filterBtn">Suodata</button>
    <div id="filterPanel" class="hidden">
      <h3>Valitse t√§git:</h3>
      <div id="filterOptions">
        <button class="filterOption" data-tag="Boxi">Boxi</button>
        <button class="filterOption" data-tag="Ditsi">Ditsi</button>
        <button class="filterOption" data-tag="Stairs">Stairs</button>
        <button class="filterOption" data-tag="Droppi">Droppi</button>
        <button class="filterOption" data-tag="G√§ppi">G√§ppi</button>
        <button class="filterOption" data-tag="Kurbi">Kurbi</button>
        <button class="filterOption" data-tag="Hillbomb">Hillbomb</button>
        <button class="filterOption" data-tag="Parkki">Parkki</button>
        <button class="filterOption" data-tag="P-Halli">P-Halli</button>
        <button class="filterOption" data-tag="DIY">DIY</button>
        <button class="filterOption" data-tag="Smuuttii Fl√§ttii">Smuuttii Fl√§ttii</button>
        <button class="filterOption" data-tag="Raffii Fl√§ttii">Raffii Fl√§ttii</button>
      </div>
    </div>
  </div>

  <div id="map" style="height: 90vh;"></div>

  <!-- ===== AUTH MODAL ===== -->
  <div id="authModal" class="modal hidden">
    <div class="modal-content">
      <span id="closeAuth" class="close">&times;</span>
      <h2>Kirjaudu sis√§√§n tai luo tili</h2>
      
      <input type="email" id="email" placeholder="Email"><br>
      <input type="password" id="password" placeholder="Password"><br><br>

      <button id="authSubmitBtn">Kirjaudu / Luo tili</button>
      <div style="margin-top: 10px; text-align: center;">
        <a href="#" id="forgotPasswordLink" style="font-size: 0.9em; color: blue; cursor: pointer;">
          Unohditko salasanan?
        </a>
      </div>
      </div>
    </div>

  <!-- ===== AUTH CONTAINER ===== -->
  <div id="authContainer" style="display: flex; gap: 10px; align-items: center; position: absolute; top: 10px; right: 10px; z-index: 1100;">

  <!-- Shown only when logged out -->
  <button id="authBtn">Kirjaudu sis√§√§n</button>

  <!-- Shown only when logged in -->
  <div id="userInfo" style="display: none; text-align: center; min-width: 120px;">
    <div style="display: flex; justify-content: center; gap: 6px; font-weight: bold;">
      <span id="userDisplayName"></span>
      <span id="userEmail"></span>
    </div>
    <img id="userProfilePic" src="" alt="Profiilikuva" style="width: 40px; height: 40px; border-radius: 50%; margin-top: 4px; display: none;">
  </div>

  <button id="profileBtn" style="display: none;">Profiili</button>
  <button id="signOutBtn" style="display: none;" onclick="signOut()">Kirjaudu ulos</button>
</div>

  <!-- Reset Password Modal -->
<div id="resetModal" class="hidden">
  <h3>Palauta salasana</h3>
  <input type="email" id="resetEmail" placeholder="S√§hk√∂posti" style="align-self: center; width: 80%; margin-top: 10px; padding: 8px;">
  <div style="margin-top: 15px; display: flex; justify-content: center; gap: 10px;">
    <button id="resetCancelBtn">Peruuta</button>
    <button id="resetSubmitBtn">L√§het√§ palautuslinkki</button>
  </div>
</div>

<!-- Profile Modal -->
<div id="profileModal" class="modal hidden">
  <div class="modal-content">
    <span id="closeProfile" class="close">&times;</span>
    <h2>Profiili</h2>

    <div id="profileDisplay">
      <img id="profilePicDisplay" src="" alt="Profiilikuva" style="max-width:80px; border-radius:50%; display:block; margin:0 auto 10px;">
      <p><strong>Nimike:</strong> <span id="displayNameText"></span></p>
      <p><strong>Email:</strong> <span id="emailText"></span></p>
    </div>

    <div id="profileEdit" style="display:none;">
      <label>Nimike:</label><br>
      <input type="text" id="displayName" placeholder=""><br>
      <label>Profiilikuvan URL:</label><br>
      <input type="text" id="profilePic" placeholder=""><br>
    </div>

    <div style="display:flex; justify-content:center; gap:10px; margin-top:10px;">
      <button id="editProfileBtn">Muokkaa</button>
      <button id="saveProfileBtn" style="display:none;">Tallenna</button>
    </div>
  </div>
</div>


    <!-- Global Popup -->
  <div id="popup" class="popup-overlay hidden">
    <div class="popup-content">
      <p id="popupMessage"></p>
      <button id="popupOkBtn" class="popup-btn">OK</button>
    </div>
  </div>

  <button id="locateBtn">üìç</button>
  
</div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    const supabaseUrl = 'https://gexjgrverbwkncorpici.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdleGpncnZlcmJ3a25jb3JwaWNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyNTEwMzcsImV4cCI6MjA3MTgyNzAzN30.kzvRZqX4ia1jcdePFfbUozQMywS5pZufX4pMv20GRow';
    window.supabase = supabase.createClient(supabaseUrl, supabaseKey);
    </script>

  <!-- Script.js JS -->
  <script src="script.js"></script>
</body>
</html>